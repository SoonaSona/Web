<link rel="stylesheet" href="/css/admit.css" />
<div class="admit-container">
  <div class="top-section">
    <div class="avatar-box">
      <svg viewBox="0 0 24 24">
        <path
          d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
        />
      </svg>
    </div>

    <div class="info-grid">
      <div class="row">
        <div class="col">
          <label class="top-label">เลขประจำตัวผู้ป่วย</label>
          <select>
            <option value="" selected disabled hidden></option>
            <option value="HN001">664883</option>
          </select>
        </div>
        <div class="col">
          <label class="top-label">ชื่อ-นามสกุล</label>
          <input type="text" placeholder="" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label class="top-label">อายุ</label>
          <input type="text" />
        </div>
        <div class="col">
          <label class="top-label">วันที่ Admit</label>
          <input type="date" />
        </div>
        <div class="col">
          <label class="top-label">สิทธิ์การรักษา</label>
          <input type="text" />
        </div>
      </div>

      <div class="row" style="width: 66%">
        <div class="col">
          <label class="top-label">น้ำหนัก</label>
          <input type="number" />
        </div>
        <div class="col">
          <label class="top-label">ส่วนสูง</label>
          <input type="number" />
        </div>
      </div>
    </div>
  </div>

  <div class="main-form">
    <div class="form-group">
      <label class="form-label">Ward</label>
      <select>
        <option>consult 1/2</option>
        <option>IPD Gen</option>
        <option>ICU</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label long">ประเภทผู้ป่วย</label>
      <select>
        <option></option>
        <option>ผู้ป่วยใน</option>
        <option>ผู้ป่วยนอก</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">เตียง</label>
      <div class="input-group">
        <input
          type="text"
          id="selectedBed"
          readonly
          placeholder="กรุณาเลือกเตียง..."
        />

        <button class="btn-action" id="btnChooseBed" type="button">
          เลือกเตียง
        </button>
      </div>
    </div>

    <div class="modal fade" id="bedModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">
              <i class="bi bi-hospital"></i> เลือกเตียงผู้ป่วย (Ward: IPD Gen)
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body bg-light">
            <div class="d-flex gap-3 mb-3 justify-content-end">
              <div class="d-flex align-items-center">
                <span class="badge bg-success me-1"> </span> ว่าง
              </div>
              <div class="d-flex align-items-center">
                <span class="badge bg-danger me-1"> </span> ไม่ว่าง
              </div>
            </div>

            <div class="bed-grid-container">
              <div class="room-label">ห้อง 101 (ห้องรวม)</div>
              <div class="bed-row">
                <div class="bed-card available" onclick="selectBed('101-1')">
                  <i class="bi bi-usb-drive-fill fs-3"></i>
                  <span>101-1</span>
                </div>
                <div class="bed-card occupied">
                  <i class="bi bi-person-fill-lock fs-3"></i>
                  <span>101-2</span>
                  <small>(คุณสมศรี)</small>
                </div>
                <div class="bed-card available" onclick="selectBed('101-3')">
                  <i class="bi bi-usb-drive-fill fs-3"></i>
                  <span>101-3</span>
                </div>
                <div class="bed-card available" onclick="selectBed('101-4')">
                  <i class="bi bi-usb-drive-fill fs-3"></i>
                  <span>101-4</span>
                </div>
              </div>

              <hr />

              <div class="room-label">ห้อง 102 (ห้องพิเศษ)</div>
              <div class="bed-row">
                <div class="bed-card available" onclick="selectBed('102-VIP')">
                  <i class="bi bi-star-fill fs-3 text-warning"></i>
                  <span>102-VIP</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label long">แพทย์ที่สั่ง Admit</label>
      <select>
        <option></option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">แผนก</label>
      <select>
        <option>consult 1/2</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label long">แพทย์เจ้าของคนไข้</label>
      <select>
        <option></option>
      </select>
    </div>

    <div class="full-width" style="margin-top: 10px">
      <label class="form-label" style="margin-top: 10px">อาการสำคัญ</label>
      <div class="textarea-wrapper">
        <textarea></textarea>
        <button class="btn-action">ICD10</button>
      </div>
    </div>
  </div>

  <div class="footer-actions">
    <button class="btn-lg btn-cancel">ยกเลิก</button>
    <button class="btn-lg btn-save">บันทึก</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  // 1. เปิด Modal เมื่อกดปุ่ม "เลือกเตียง"
  const btnChooseBed = document.getElementById("btnChooseBed");
  const bedModalEl = document.getElementById("bedModal");
  const bedModal = new bootstrap.Modal(bedModalEl);

  btnChooseBed.addEventListener("click", () => {
    bedModal.show();
  });

  // 2. ฟังก์ชันเมื่อเลือกเตียง (ถูกเรียกจาก HTML onclick)
  function selectBed(bedName) {
    // อัปเดตค่าลงใน input
    document.getElementById("selectedBed").value = bedName;

    // ปิด Modal
    bedModal.hide();

    // (Optional) แจ้งเตือนเล็กๆ
    const Toast = Swal.mixin({
      toast: true,
      position: "top-end",
      showConfirmButton: false,
      timer: 1500,
    });
    Toast.fire({
      icon: "success",
      title: `เลือกเตียง ${bedName} แล้ว`,
    });
  }

  // -----------------------------------------------------
  // แถม: ฟังก์ชันดึงข้อมูลผู้ป่วยอัตโนมัติ (Mock Data)
  // -----------------------------------------------------
  const hnSelect = document.querySelector("select"); // ช่องเลือก HN
  const nameInput = document.querySelector('input[placeholder=""]'); // ช่องชื่อ
  const ageInput = document.querySelector(".row .col:nth-child(1) input"); // ช่องอายุ (เดาจากลำดับ)

  hnSelect.addEventListener("change", function () {
    if (this.value === "HN001") {
      nameInput.value = "นายทดสอบ ระบบดี";
      // หา input ตัวอื่นๆ แล้วใส่ค่า
      document.querySelectorAll("input")[2].value = "35 ปี"; // อายุ
      document.querySelectorAll("input")[4].value = "ประกันสังคม"; // สิทธิ์
      document.querySelectorAll("input")[5].value = "70"; // น้ำหนัก
      document.querySelectorAll("input")[6].value = "175"; // ส่วนสูง
    }
  });
</script>
